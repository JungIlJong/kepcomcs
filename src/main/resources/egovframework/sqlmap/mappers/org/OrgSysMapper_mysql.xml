<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.daonplace.vasanta.domain.org.mapper.OrgSysMapper">

	<select id="selectOrgListAll" resultType="org">
		SELECT ORG_ID,
		       ID,
			   ORG_NM,
			   UPPER_ORG_ID,
			   ORG_ORDR,
			   ORG_DP,
		       USE_AT
		FROM VST_ORG
	</select>

	<select id="selectOrgList" resultType="org">
		SELECT ORG_ID,
		       ID,
			   ORG_NM,
			   UPPER_ORG_ID,
			   ORG_ORDR,
			   ORG_DP,
			   USE_AT
		FROM VST_ORG
		AND USE_AT = 'Y'
		ORDER BY ORG_DP ASC, ORG_ORDR ASC
	</select>

	<insert id="insertOrg" parameterType="org" useGeneratedKeys="true" keyProperty="orgId">
		INSERT INTO VST_ORG (
		                      ORG_NM,
		                      UPPER_ORG_ID,
		                      ORG_ORDR,
		                      ORG_DP,
		                      USE_AT
		) VALUES (
		          #{orgNm},
		          #{upperOrgId},
		          #{orgOrdr},
		          #{orgDp},
		          #{useAt}
		)
	</insert>

	<select id="selectNextOrgOrdrByUpperOrgId" parameterType="Long" resultType="int">
		SELECT IFNULL(MAX(ORG_ORDR), 0) + 1
		FROM VST_ORG
		WHERE UPPER_ORG_ID = #{upperOrgId}
	</select>

	<update id="updateOrg" parameterType="org">
		UPDATE VST_ORG
		SET ID = #{id},
		    ORG_NM = #{orgNm},
		    UPPER_ORG_ID = #{upperOrgId},
		    ORG_ORDR = #{orgOrdr},
		    USE_AT = #{useAt}
		WHERE ORG_ID = #{orgId}
	</update>

	<delete id="deleteOrg" parameterType="Long">
		DELETE FROM VST_ORG WHERE ORG_ID = #{orgId}
	</delete>

	<select id="selectOrgListByRole" resultType="org">
		SELECT A.ID,
		A.ORG_ID,
		A.ORG_NM,
		A.UPPER_ORG_ID,
		A.ORG_ORDR,
		A.ORG_TY,
		A.ORG_DP,
		A.CNTC_ID,
		A.URL,
		A.USE_AT,
		A.GNB_AT,
		A.ORG_SE
		FROM VST_ORG A
		WHERE A.ORG_ID IN (SELECT DISTINCT B.ORG_ID
		FROM VST_ORG_AUTHRT B
		LEFT JOIN VST_AUTHRT C ON B.AUTHRT_ID = C.AUTHRT_ID
		WHERE C.AUTHRT_CD IN
		<foreach collection="authorityList" item="item" separator="," open="(" close=")">
			#{item}
		</foreach>
		)
		AND A.ORG_SE = 'MNGR'
		AND A.USE_AT = 'Y'
		ORDER BY A.ORG_DP ASC, A.ORG_ORDR ASC
	</select>

	<select id="selectOrgById" parameterType="String" resultType="org">
		SELECT ORG_ID,
			   ID,
			   ORG_NM,
			   UPPER_ORG_ID,
			   ORG_ORDR,
			   ORG_DP,
			   USE_AT
		FROM VST_ORG
		WHERE ID = #{id}
	</select>

</mapper>