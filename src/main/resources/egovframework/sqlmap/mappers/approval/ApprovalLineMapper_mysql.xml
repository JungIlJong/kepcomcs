<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.daonplace.vasanta.domain.approval.mapper.ApprovalLineMapper">

	<insert id="insertApprovalLine" parameterType="java.util.List">
		INSERT INTO approval_lines (approval_document_id, approver_id, approval_order, approval_status)
		VALUES
		<foreach collection="approvalLines" item="approvalLine" separator=",">
			(#{approvalLine.approvalDocumentId},
			 (SELECT MBR_ID FROM VST_MBR WHERE uuid = #{approvalLine.approverUuid}),
			 #{approvalLine.approvalOrder},
			 #{approvalLine.approvalStatus})
		</foreach>
	</insert>

	<update id="cancelApprovalLine" parameterType="Long">
		UPDATE approval_lines
		SET approval_status = 'C'
		WHERE approval_document_id = #{approvalDocumentId}
	</update>

	<update id="rejectApprovalLine" parameterType="Long">
		UPDATE approval_lines
		SET approval_status = 'D'
		WHERE approval_line_id = #{approvalLineId}
	</update>

	<update id="acceptApprovalLine" parameterType="Long">
		UPDATE approval_lines
		SET approval_status = 'A'
		WHERE approval_line_id = #{approvalLineId}
	</update>

	<select id="countAcceptApprovalLine" parameterType="Long" resultType="int">
		SELECT COUNT(*)
		FROM approval_lines
		WHERE approval_document_id = #{approvalDocumentId}
		AND approval_status != 'A'
	</select>

</mapper>