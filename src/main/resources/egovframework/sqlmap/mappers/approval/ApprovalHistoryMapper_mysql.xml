<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.daonplace.vasanta.domain.approval.mapper.ApprovalHistoryMapper">

	<select id="selectApprovalHistoryByApprovalDocumentId" parameterType="Long" resultType="egovMap">
		SELECT VM.MBR_NM,
			   ah.approval_status,
			   CASE
				   WHEN ah.approval_status = 'N'
					   THEN '결재요청'
				   WHEN ah.approval_status = 'P'
					   THEN '결재중'
				   WHEN ah.approval_status = 'A'
					   THEN '결재완료'
				   WHEN ah.approval_status = 'D'
					   THEN '반려'
				   WHEN ah.approval_status = 'C'
					   THEN '취소'
				   END AS approval_status_nm,
		    	IFNULL(ah.approval_comment, '-') AS approval_comment,
		    	DATE_FORMAT(ah.approved_at, '%Y-%m-%d %H:%i:%s') AS approved_at
		FROM approval_history ah
		LEFT JOIN VST_MBR VM ON ah.approver_id = VM.MBR_ID
		WHERE ah.approval_document_id = #{approvalDocumentId}
		ORDER BY approved_at DESC
	</select>

	<insert id="insertApprovalHistory" parameterType="approvalHistory">
		INSERT INTO approval_history (approval_document_id, approver_id, approval_status, approval_comment, approved_at)
		VALUES (#{approvalDocumentId}, #{approverId}, #{approvalStatus}, #{approvalComment}, #{approvedAt})
	</insert>

</mapper>